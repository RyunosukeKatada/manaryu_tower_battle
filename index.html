<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>タワーバトル - Base64画像版</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: #eef;
      font-family: sans-serif;
      touch-action: none;
    }
    canvas {
      display: block;
    }
    #dropButton {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      padding: 12px 24px;
      font-size: 20px;
      background: #ffcc00;
      border: 2px solid #888;
      border-radius: 10px;
      cursor: pointer;
      z-index: 10;
    }
  </style>
</head>
<body>
  <button id="dropButton">ドロップ</button>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
  <script id="imageData" type="application/json">
  {
    "lion": {
      "data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABuUlEQVRYR+2WMU7DMBBF30W0A3ZAE7ABO4ADugA7oAO6ADugA7UAXpTUtEkS5l6TSUVK8Nx2Hj92J/0XxZC2HppZpmzZyMITrda7UnuEpL8eLuMf6NYbPYCAuAxW9lhFhP8AOjGACyq4MddnM+5+qIG5VnQu4CpDA6xG+yMR6gnEJG5CXcOZ+AsY+QBBld6mvflFcAtC9QM6YuDSH4q6FEl4QPhOYCE4CC1Kjpc7XZGbXxZ8UpL0SJBtv4lt54rMY3x0oewfAxUJHZbdcE9+j6iv4KmrwKzDOqKJ3d+0eDbKRUlDXqqnh2M9+1jraM2mJPZZsRH9ybk/jqxZ7KXwrzrPNsx7T64FDslUAvlZ86zVm8B2a2A8AGa7vLDsv/hhZwlT3F1AtVSkTwIuJ5crbt/BThUdICnkOexFG3FbMJSnbY9+AsEAp9AHOyjNRIj7AsAAAAASUVORK5CYII=",
      "weight": 3
    },
    "panda": {
      "data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABbklEQVRYR+2WMU7DMBBFz+WQG9AEb0ATsAE7gATsAE7gATsAE7gATqfSrEkqTpMoUev+QzS5fV3dmYu0LgI+fVyrt9m6Fe7VkBR3p+OVPVRnNqBaRCgAlYDCaUMgDQEAoCI7fvmJQW34DMG9AZ4AHoBbQHuBiYBzETSw4RwFMYCEd7hTgeQpsDS4BWdz+8+omxPmtAW/4Et7+pXt1kcoDz+El+KsHrYOEFbl0MkPPpb19pgzYl53sF9jwBYwMjhcHCUw/Vb3Pj6mtyU+RqwFslUAnks7XlmJMyiWMSlme09k3yl1UL2F4w5JdnN41j7PwnOlzY7vcRhwq6FiM3bYWrwvO2hLYnP8E8GVaAlwUZj5NddUAAAAASUVORK5CYII=",
      "weight": 2
    },
    "rabbit": {
      "data": "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABg0lEQVRYR+2WMU7DMBBFZ4xgDdoAXaADdgBdoAN2AF2gA3YAXaAC/SSpJMm0zItKRJNRx+CvPe5NvTzL9u1XPbx/jJD1Z0pxZlPXeULmnB2NgC6ATZfJbSpLaqzAf+hbiuAC8An4C7APv6jj0LRA/AYcD2EUoW9yYwgA+Gr8c4AG8AmQGjhtZvgC9WCKUbj1EqJmgAf8I7TSLbWr0BNh7FhEqJm3zRWECXYA9Yx+8rEjIybF4WbnOVkLOlL3rKcxTc93cKsybPWAdetQDWaVsFvBnO95ug28LONHKnBL1K7J5ErH3V4r9XcDRTjMyTSq4iA7iU9wRa+FTrX6m7mfTFyaV4cRqa9B4q3cdZp3HJK0xF7bhd+nC8WfoaYt0wAAAABJRU5ErkJggg==",
      "weight": 1
    }
  }
  </script>

  <script>
    const { Engine, Render, Runner, World, Bodies, Events } = Matter;

    const canvas = document.createElement('canvas');
    document.body.appendChild(canvas);
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const engine = Engine.create();
    const world = engine.world;
    engine.gravity.y = 0.4;

    const render = Render.create({
      canvas: canvas,
      engine: engine,
      options: {
        width: canvas.width,
        height: canvas.height,
        wireframes: false,
        background: '#eef'
      }
    });
    Render.run(render);
    Runner.run(Runner.create(), engine);

    // 台座
    const platform = Bodies.rectangle(canvas.width / 2, canvas.height - 60, canvas.width * 0.6, 40, {
      isStatic: true,
      render: { fillStyle: '#888' }
    });
    World.add(world, platform);

    // Base64画像データの読み込み
    const imageData = JSON.parse(document.getElementById('imageData').textContent);
    const animalList = Object.entries(imageData).map(([key, val]) => ({
      name: key,
      texture: val.data,
      weight: val.weight
    }));

    // 重みによるランダム選択
    function getWeightedAnimal() {
      const total = animalList.reduce((sum, item) => sum + item.weight, 0);
      let rand = Math.random() * total;
      for (const item of animalList) {
        if (rand < item.weight) return item;
        rand -= item.weight;
      }
    }

    // ドロップ処理
    document.getElementById('dropButton').addEventListener('click', () => {
      const animal = getWeightedAnimal();
      const size = 64;
      const x = canvas.width / 2;
      const body = Bodies.rectangle(x, 0, size, size, {
        restitution: 0.2,
        friction: 0.8,
        render: {
          sprite: {
            texture: animal.texture,
            xScale: 1,
            yScale: 1
          }
        }
      });
      World.add(world, body);
    });
  </script>
</body>
</html>