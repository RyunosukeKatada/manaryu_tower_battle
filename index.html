<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>物理ブロックバトル</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" rel="stylesheet">
  <style>
    canvas {
      display: block;
      margin: auto;
      background: #eef1f5;
      border-radius: 8px;
      max-width: 100%;
      height: auto;
    }
    .center {
      text-align: center;
    }
  </style>
</head>
<body>

<nav class="container-fluid">
  <ul>
    <li><strong>ブロックバトル</strong></li>
  </ul>
  <ul>
    <li><a href="#">遊び方</a></li>
    <li><a href="#">画像変更</a></li>
    <li><a href="#" role="button">リセット</a></li>
  </ul>
</nav>

<main class="container">
  <div class="grid">
    <section>
      <hgroup>
        <h2>どうぶつ…じゃないけどタワーバトル</h2>
        <h3>物理演算で画像を積んでいこう</h3>
      </hgroup>
      <p class="center">画面をタップ or クリックすると、ランダムなブロックが落ちます。</p>
      <canvas id="gameCanvas" width="400" height="600"></canvas>
    </section>
  </div>
</main>

<section aria-label="Subscribe example">
  <div class="container">
    <article>
      <hgroup>
        <h2>ゲーム更新を受け取る</h2>
        <h3>開発の進捗や素材募集などをお知らせ予定！</h3>
      </hgroup>
      <form class="grid">
        <input type="text" id="firstname" name="firstname" placeholder="名前" aria-label="名前" required />
        <input type="email" id="email" name="email" placeholder="メールアドレス" aria-label="メールアドレス" required />
        <button type="submit" onclick="event.preventDefault()">登録</button>
      </form>
    </article>
  </div>
</section>

<footer class="container">
  <small><a href="#">GitHub</a> • <a href="#">利用規約</a></small>
</footer>

<script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>
<script>
  const { Engine, Render, Runner, Bodies, World, Events, Composite } = Matter;

  const engine = Engine.create();
  const world = engine.world;
  const canvas = document.getElementById("gameCanvas");

  const render = Render.create({
    canvas: canvas,
    engine: engine,
    options: {
      width: 400,
      height: 600,
      wireframes: false,
      background: "#eef1f5"
    }
  });

  Render.run(render);
  const runner = Runner.create();
  Runner.run(runner, engine);

  // 地面と壁
  const ground = Bodies.rectangle(200, 610, 400, 60, { isStatic: true });
  const leftWall = Bodies.rectangle(-10, 300, 20, 600, { isStatic: true });
  const rightWall = Bodies.rectangle(410, 300, 20, 600, { isStatic: true });
  World.add(world, [ground, leftWall, rightWall]);

  // ブロック画像一覧
  const imageFiles = [
    'images/dumbbell.png',
    'images/fashion.png',
    'images/motorcycle.png',
    'images/man_kimono.png',
    'images/woman_barbell.png',
    'images/woman_kimono.png'
  ];

  // ブロック生成
  function dropRandomBlock() {
    const imgSrc = imageFiles[Math.floor(Math.random() * imageFiles.length)];
    const texture = new Image();
    texture.src = imgSrc;
    texture.onload = () => {
      const w = 80, h = 80;
      const block = Bodies.rectangle(200, 0, w, h, {
        render: {
          sprite: {
            texture: imgSrc,
            xScale: w / texture.width,
            yScale: h / texture.height
          }
        }
      });
      World.add(world, block);
    };
  }

  // タップ・クリックでブロックを落とす
  canvas.addEventListener("mousedown", dropRandomBlock);
  canvas.addEventListener("touchstart", function(e) {
    e.preventDefault();
    dropRandomBlock();
  }, { passive: false });

</script>
</body>
</html>
